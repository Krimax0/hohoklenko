"use client";

import { useRef, useCallback, useEffect } from "react";
import { Howl } from "howler";

type SoundType = "tick" | "win_common" | "win_uncommon" | "win_rare" | "win_epic" | "win_legendary" | "win_mythic" | "spin_start" | "spin_end";

const SOUND_URLS: Record<SoundType, string> = {
  tick: "data:audio/wav;base64,UklGRpYGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YXIGAACAf35+fn1+fn5+fn5+f39/f4CAgH9/f39/f39/f39/f39/f39/f39/gH9/gH+Af4B/gH+Af4CAgICAgICAgH+Af39/f39+fn5+fn5+fn5+fn5+fn5+fn5/f39/gICAgICAgICAgICAgICAgH+AgH9/fn5+fn5+fn9/f3+AgH+Af35+fn5+fn5+fn5+fn5+fn9/f3+AgICAgICAgICAf39/f39/f39/f3+AgICAf3+Af39/f39/f3+AgICAgICAgH9/f35+fn5+fn5+fn9/f39/gICAf39/f39/f4CAf39/f39/f39/f39/f39/gH+Af4B/gH+Af4B/gH9/fn5+fn5+fn5+fn5+f39/gICAgICAgICAgICAf4B/f35+fn5+f39/f4CAgICAgH9/f39/f39/f39/gICAgIB/gH9/f39/f39/f3+AgICAf39/f39/f39/f39/gICAgH9/f39+fn5+fn5+f3+AgIB/f39/f39/f39/f39/f4CAgICAgH9/f39/f39/f3+AgIB/f39+fn5+fn9/f4CAf39/f39/f39/f39/f4CAgH9/f39/f39/f39/f4CAgH9/fn5+fn5+fn9/gIB/f39/f39/f39/f39/gICAf39/f39/f39/f39/gIB/f35+fn5+fn5/f4CAgH9/f39/f39/f39/f4CAf39/f39/f39/f39/gIB/f35+fn5+fn5+f3+AgH9/f39/f39/f39/f4CAgH9/f39/f39/f39/gIB/f35+fn5+fn5+f4CAf39/f39/f39/f39/gIB/f39/f39/f39/f4CAf39+fn5+fn5+fn+AgH9/f39/f39/f39/gIB/f39/f39/f39/f4CAf39+fn5+fn5+fn+Af39/f39/f39/f39/gIB/f39/f39/f39/f4B/f39+fn5+fn5+f4CAf39/f39/f39/f3+AgH9/f39/f39/f39/gH9/fn5+fn5+fn5/gH9/f39/f39/f39/gIB/f39/f39/f39/f4B/f35+fn5+fn5+f4B/f39/f39/f39/gIB/f39/f39/f39/f4B/f35+fn5+fn5/gH9/f39/f39/f39/gH9/f39/f39/f39/gH9/fn5+fn5+fn+Af39/f39/f39/f4B/f39/f39/f39/gH9/f35+fn5+fn5/gH9/f39/f39/f3+Af39/f39/f39/f39/f35+fn5+fn5/gH9/f39/f39/f3+Af39/f39/f39/f39/fn5+fn5+fn+Af39/f39/f39/gH9/f39/f39/f39/f39+fn5+fn5/gH9/f39/f39/f4B/f39/f39/f39/f39/fn5+fn5+f4B/f39/f39/f3+Af39/f39/f39/f39/f35+fn5+f4B/f39/f39/f4B/f39/f39/f39/f39/fn5+fn5/gH9/f39/f39/gH9/f39/f39/f39/f35+fn5+gH9/f39/f39/gH9/f39/f39/f39/fn5+fn5/gH9/f39/f3+Af39/f39/f39/f39+fn5+fn+Af39/f39/f4B/f39/f39/f39/f35+fn5/gH9/f39/f39/gH9/f39/f39/f39+fn5+f4B/f39/f39/gH9/f39/f39/f39/fn5+fn+Af39/f39/f4B/f39/f39/f39/fn5+fn+Af39/f39/gH9/f39/f39/f39+fn5+f4B/f39/f39/gH9/f39/f39/f35+fn5/gH9/f39/f4B/f39/f39/f39+fn5+gH9/f39/f3+Af39/f39/f39/fn5+f4B/f39/f39/gH9/f39/f39/f35+fn+Af39/f39/gH9/f39/f39/fn5+f4B/f39/f39/gH9/f39/f39+fn5/gH9/f39/f4B/f39/f39/fn5+f4B/f39/f3+Af39/f39/fn5+f4B/f39/f3+Af39/f39/fn5+gH9/f39/f4B/f39/f39+fn5/gH9/f39/gH9/f39/f35+fn+Af39/f4B/f39/f35+fn+Af39/f4B/f39/f35+fn+Af39/gH9/f39/fn5+gH9/f4B/f39/f35+fn+Af39/gH9/f39+fn5/gH9/gH9/f39+fn5/gH9/gH9/f39+fn5/gH9/gH9/f35+fn+Af3+Af39/fn5+f4B/gH9/f35+fn+Af4B/f39+fn5/gH+Af39+fn5/gH+Af39+fn5/gH+Af35+fn+Af4B/fn5+gH+Af39+fn+Af4B/fn5/gH+Af35+f4B/gH9+fn+Af4B/fn6Af4B/fn5/gIB/fn5/gIB/fn5/gH9/fn5/gH9/fn5/gH9/fn5/gH9/fn6Af39/fn6Af39+fn+Af39+fn+Af39+f3+Af39+f3+Af39+f4CAf39+f4CAf35+f4CAf35/gIB/f35/gIB/f35/gIB/f35/gIB/f3+AgH9/f4CAf39/gIB/f3+AgH9/f4CAf39/gIB/gH+AgH9/gICAf39/gICAgH+AgICAgICAgICAgICAgICAgICAgICA",
  spin_start: "data:audio/wav;base64,UklGRlYIAABXQVZFZm10IBAAAAABAAEAIlYAABKuAAACAAgAZGF0YTIIAACAf3+AgICAf39/f39/gICAf39/f3+Af3+AgH9/f4B/f4CAf39/gH9/gIB/f39/f3+AgH9/f39/f4CAf39/f39/gIB/f39/f3+AgH9/f39/f4CAf39/f39/gIB/f3+Af3+AgH9/f4B/f4CAf3+AgH9/gIB/f4CAf4CAgH+AgIB/gICAf4CAgH+AgIB/gICAgICAgICAg",
  spin_end: "data:audio/wav;base64,UklGRmQJAABXQVZFZm10IBAAAAABAAEAIlYAABKuAAACAAgAZGF0YUAJAACAf3+AgICAgIB/f39/f4CAgH9/f39/gIB/f4B/f4CAgH+AgH+AgICAf4CAf4CAf3+AgH9/gH9/gIB/f39/f4CAf39/f39/gIB/f39/f3+AgH9/f39/gIB/f39/f4CAf39/f39/gICAf39/f4CAgH9/f3+AgIB/f39/gICAf39/f4CAgH9/f4CAgIB/f3+AgICAf3+AgICAgH9/gICAgIB/f4CAgICAf3+AgICAgIB/gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgA",
  win_common: "data:audio/wav;base64,UklGRnQEAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YVAEAAB/f39/f39/f39/f39/f39/f39/f39/f39/f39/gICAgICAgICAgICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/f39/f39/gICAgICAgICAgICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/f39/f39/gICAgICAgICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/f39/f4CAgICAgICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/f39/gICAgICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/f39/gICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/f4CAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/gICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f4CAgICAgICAgICAgIB/f39/f39/f39/f39/f39/f4CAgICAgICAgIB/f39/f39/f39/f39/f4CAgICAgICAgH9/f39/f39/f39/f4CAgICAgIB/f39/f39/f39/f4CAgICAgH9/f39/f39/f4CAgIB/f39/f39/gICAgH9/f39/gIB/f39/gIB/f3+AgH+Af4B/gH+Af4B/gH+Af4CAgICAgICAgICA",
  win_uncommon: "data:audio/wav;base64,UklGRnQFAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YVAFAACAf39/f39/f39/f39/f39/f39/f39/f39/f4CAgICAgICAgICAgICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/f39/f39/gICAgICAgICAgICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/f39/f39/gICAgICAgICAgICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/f39/f39/gICAgICAgICAgICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/f39/f39/gICAgICAgICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/f39/f4CAgICAgICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/f39/gICAgICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/f4CAgICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/gICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f4CAgICAgICAgICAgICAgIB/f39/f39/f39/f39/f39/gICAgICAgICAgICAgIB/f39/f39/f39/f39/gICAgICAgICAgIB/f39/f39/f39/f4CAgICAgICAgH9/f39/f39/f4CAgICAgIB/f39/f39/gICAgICAgH9/f39/f4CAgICAgH9/f39/gICAgIB/f39/gICAgH9/f4CAf4B/gH+Af4B/gH+Af4B/gICAgICAgICAgICAgICA",
  win_rare: "data:audio/wav;base64,UklGRjQGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YRAGAACAf39/f39/f39/f39/f39/f39/f39/f39/f39/gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/f39/f39/f39/gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/f39/f39/f39/gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/f39/f39/f39/gICAgICAgICAgICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/f39/f39/f4CAgICAgICAgICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/f39/f39/gICAgICAgICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/f39/f4CAgICAgICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/f39/gICAgICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/f4CAgICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/gICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f4CAgICAgICAgICAgICAgIB/f39/f39/f39/f39/f39/gICAgICAgICAgICAgIB/f39/f39/f39/f39/f4CAgICAgICAgICAgH9/f39/f39/f39/f4CAgICAgICAgIB/f39/f39/f39/f4CAgICAgICAgH9/f39/f39/gICAgICAgIB/f39/f39/gICAgICAgH9/f39/f4CAgICAgH9/f39/gICAgIB/f39/gICAgH9/gICAf4B/gH+Af4CAgICAgICAgICAgICAf4CAgICAgICAgICA",
  win_epic: "data:audio/wav;base64,UklGRrQGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YZAGAACAf39/f39/f39/f39/f39/f39/f39/f39/f39/f39/gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/f39/f39/f39/f4CAgICAgICAgICAgICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/f39/f39/f39/gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/f39/f39/f39/gICAgICAgICAgICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/f39/f39/f4CAgICAgICAgICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/f39/f39/gICAgICAgICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/f39/f4CAgICAgICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/f39/gICAgICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/f4CAgICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/gICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f4CAgICAgICAgICAgICAgIB/f39/f39/f39/f39/f39/gICAgICAgICAgICAgIB/f39/f39/f39/f39/f4CAgICAgICAgICAgH9/f39/f39/f39/f4CAgICAgICAgIB/f39/f39/f39/gICAgICAgIB/f39/f39/f4CAgICAgIB/f39/f39/gICAgICAgH9/f39/gICAgIB/f39/gICAgH9/gICAf4B/gH+Af4CAgICAgICAgICAgIB/gICAgICAgICAgICAf4CAgICAgICAgICAgICAgICAgICAf4CAgICAgICAgICAgICA",
  win_legendary: "data:audio/wav;base64,UklGRjQHAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YRAHAACAf39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/gICAgICAgICAgICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/f39/f39/f39/f4CAgICAgICAgICAgICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/f39/f39/f39/gICAgICAgICAgICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/f39/f39/f39/gICAgICAgICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/f39/f39/f4CAgICAgICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/f39/f39/gICAgICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/f39/f4CAgICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/f39/gICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/f4CAgICAgICAgICAgICAgIB/f39/f39/f39/f39/f39/f4CAgICAgICAgICAgIB/f39/f39/f39/f39/f39/gICAgICAgICAgIB/f39/f39/f39/f39/gICAgICAgIB/f39/f39/f39/f4CAgICAgH9/f39/f39/gICAgIB/f39/f39/gICAgH9/f39/gICAgH9/gH+Af4B/gH+AgICAgICAgICAf4CAgICAgICAgIB/gICAgICAgICAf4CAgICAgICAgICAgICAgICAgICAf4CAgICAgICAgICAgICAf4CAgICAgICAgICAgICAf4CAgICAgICAgICAgICAgICAgICAgICAgICAf4CAgICAgICAgICA",
  win_mythic: "data:audio/wav;base64,UklGRrQHAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YZAHAACAf39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f4CAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f4CAgICAgICAgICAgICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/gICAgICAgICAgICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/f39/f39/f39/f4CAgICAgICAgICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/f39/f39/f39/gICAgICAgICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/f39/f39/f4CAgICAgICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/f39/f39/gICAgICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/f39/f4CAgICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/f39/gICAgICAgICAgICAgICAgICAgH9/f39/f39/f39/f39/f39/f39/f4CAgICAgICAgICAgICAgIB/f39/f39/f39/f39/f39/f4CAgICAgICAgICAgIB/f39/f39/f39/f39/f39/gICAgICAgICAgIB/f39/f39/f39/f39/gICAgICAgIB/f39/f39/f39/gICAgIB/f39/f39/gICAgH9/f3+Af4B/gH+Af4CAgICAgICAf4CAgICAgICAf4CAgICAgIB/gICAgICAgICAgICAgICAgH+AgICAgICAgICAgIB/gICAgICAgICAgICAf4CAgICAgICAgICAgICAgICAgIB/gICAgICAgICAgICAf4CAgICAgICAgICAgIB/gICAgICAgICAgICAgICAgICAgICAf4CAgICAgICAgICAgICAgICAgICAgH+AgICAgICAgICA",
};

export function useSound() {
  const soundsRef = useRef<Map<SoundType, Howl>>(new Map());
  const isInitialized = useRef(false);

  useEffect(() => {
    if (isInitialized.current) return;
    isInitialized.current = true;

    // Pre-load all sounds
    Object.entries(SOUND_URLS).forEach(([key, url]) => {
      const sound = new Howl({
        src: [url],
        volume: key.startsWith("win_") ? 0.7 : 0.3,
        preload: true,
      });
      soundsRef.current.set(key as SoundType, sound);
    });

    return () => {
      soundsRef.current.forEach((sound) => sound.unload());
      soundsRef.current.clear();
    };
  }, []);

  const play = useCallback((type: SoundType) => {
    const sound = soundsRef.current.get(type);
    if (sound) {
      sound.play();
    }
  }, []);

  const playTick = useCallback(() => {
    play("tick");
  }, [play]);

  const playWin = useCallback((rarity: string) => {
    const soundType = `win_${rarity}` as SoundType;
    if (soundsRef.current.has(soundType)) {
      play(soundType);
    } else {
      play("win_common");
    }
  }, [play]);

  const playSpinStart = useCallback(() => {
    play("spin_start");
  }, [play]);

  const playSpinEnd = useCallback(() => {
    play("spin_end");
  }, [play]);

  return {
    play,
    playTick,
    playWin,
    playSpinStart,
    playSpinEnd,
  };
}
